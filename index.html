<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="./manifest.json">

    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DonyBurguer's">
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
    <title>COZINHA SUPREME - JDP INDUSTRIAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --gold: #d4af37;
            --dark: #000;
            --card-bg: #111;
        }
        body { 
            background: var(--dark); 
            color: #fff; 
            font-family: 'Arial Black', sans-serif; 
            margin: 0; 
            padding: 20px;
        }
        header { 
            border-bottom: 3px solid var(--gold); 
            padding: 15px; 
            margin-bottom: 30px; 
            text-align: center;
            background: #050505;
        }
        h1 { 
            background: linear-gradient(145deg, #bf953f 0%, #fcf6ba 50%, #b38728 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0; 
            font-size: 2rem; 
        }
        
        .grid-pedidos { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 25px; 
        }
        
        .pedido-card { 
            background: var(--card-bg); 
            border: 2px solid #222; 
            border-top: 8px solid var(--gold); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .pedido-header { 
            display: flex; 
            justify-content: space-between; 
            border-bottom: 1px solid #333; 
            padding-bottom: 10px; 
            margin-bottom: 15px; 
        }
        .item-linha { 
            padding: 8px 0;
            border-bottom: 1px solid #1a1a1a;
            font-size: 1.2rem;
            color: #00ff8;
        }
        .total { 
            margin-top: 20px; 
            font-size: 1.5rem; 
            color: var(--gold); 
            text-align: right; 
        }
        
        .btn-concluir { 
            background: linear-gradient(145deg, #bf953f, #b38728);
            color: #000; 
            border: none; 
            width: 100%; 
            padding: 15px; 
            font-weight: 900; 
            cursor: pointer; 
            margin-top: 20px; 
            border-radius: 8px; 
            font-size: 1.1rem;
        }

        .aviso-vazio { 
            grid-column: 1 / -1;
            text-align: center; 
            color: #333; 
            margin-top: 100px; 
            font-size: 2rem;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<header>
    <h1> DONY BURGUERS</h1>
    <p id="status" style="color: #00ff8; font-size: 12px; margin-top: 5px;">SISTEMA COZINHA</p>
</header>

<div id="container-pedidos" class="grid-pedidos">
    <div class="aviso-vazio">Aguardando Pedidos...</div>
</div>

<audio id="sino-alerta" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCEdXF7ScnMYz0Ce0OW-B_UJ8Bm5Pl9m8o", 
        databaseURL: "https://dony-burguers-default-rtdb.firebaseio.com" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const sino = document.getElementById('sino-alerta');
    let primeiroCarregamento = true;

    // Escuta em Tempo Real
    db.ref('PEDIDOS_PRODUCAO').on('value', (snapshot) => {
        const container = document.getElementById('container-pedidos');
        const pedidos = snapshot.val();
        
        if (!pedidos) {
            container.innerHTML = '<div class="aviso-vazio">Cozinha Limpa!</div>';
            return;
        }

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(() => console.log("Nave pronta!"));
            }

        // Toca o sino se não for a primeira vez que abre a página
        if (!primeiroCarregamento) {
            sino.play().catch(() => console.log("Permita o áudio no navegador"));
        }
        primeiroCarregamento = false;

        container.innerHTML = '';
        const lista = Object.entries(pedidos).reverse();

        lista.forEach(([id, dados]) => {
            let itensHtml = dados.itens.map(i => `<div class="item-linha">● 1x ${i.nome}</div>`).join('');
            
            const div = document.createElement('div');
            div.className = 'pedido-card';
            div.innerHTML = `
                <div class="pedido-header">
                    <span style="color: var(--gold);">ID: ${id.substring(1, 6)}</span>
                    <span style="font-size: 12px; color: #888;">${dados.data || ''}</span>
                </div>
                <div>${itensHtml}</div>
                <div class="total">TOTAL: ${dados.total}</div>
                <button class="btn-concluir" onclick="finalizar('${id}')">CONCLUÍDO / REMOVER</button>
            `;
            container.appendChild(div);
        });
    });

    function finalizar(id) {
        if(confirm("Deseja despachar este pedido?")) {
            db.ref('PEDIDOS_PRODUCAO').child(id).remove();
        }
    }

    // Ativar áudio no primeiro clique (Regra do Navegador)
    document.body.onclick = () => { sino.load(); console.log("Áudio Habilitado"); };
</script>

</body>
</html>
